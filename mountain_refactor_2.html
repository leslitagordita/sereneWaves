<!--                                                                                                                       
     #####    ##         ###   ###                       ##### ##                                          ##     ###    
  ######  /  #### /       ###   ###                   ######  /### /         #                              ##     ###   
 /#   /  /   ####/         ##    ##                  /#   /  /  ##/         ###                             ##      ##   
/    /  /    # #           ##    ##                 /    /  /    #           #                              ##      ##   
    /  /     #             ##    ##                     /  /                                                ##      ##   
   ## ##     #      /##    ##    ##      /###          ## ##   ###  /###   ###       /##  ###  /###     ### ##      ##   
   ## ##     #     / ###   ##    ##     / ###  /       ## ##    ###/ #### / ###     / ###  ###/ #### / #########    ##   
   ## ########    /   ###  ##    ##    /   ###/        ## ###### ##   ###/   ##    /   ###  ##   ###/ ##   ####     ##   
   ## ##     #   ##    ### ##    ##   ##    ##         ## #####  ##          ##   ##    ### ##    ##  ##    ##      ##   
   ## ##     ##  ########  ##    ##   ##    ##         ## ##     ##          ##   ########  ##    ##  ##    ##      ### /
   #  ##     ##  #######   ##    ##   ##    ##         #  ##     ##          ##   #######   ##    ##  ##    ##       ##/ 
      /       ## ##        ##    ##   ##    ##            #      ##          ##   ##        ##    ##  ##    ##           
  /##/        ## ####    / ##    ##   ##    ##        /####      ##          ##   ####    / ##    ##  ##    /#       #   
 /  #####      ## ######/  ### / ### / ######        /  #####    ###         ### / ######/  ###   ###  ####/        ###  
/     ##           #####    ##/   ##/   ####        /    ###      ###         ##/   #####    ###   ###  ###          #   
#                                                   #                                                                    
 ##                                                  ##                                                                  
 --> 

<!DOCTYPE html>                                                                                                                       
<html>

  <head>
    <meta charset="utf-8">
    <script src="js/jquery-1.11.1.js"></script>
    <script src="js/fabric.js-1.4.12/dist/fabric.js"></script>
    <link rel="stylesheet" type="text/css" href="styles/main.css"/>
  </head>

  <body>
    <div id = "container">
        <canvas id="canvas" width="" height="" style="border:1px solid #ccc"></canvas>
    </div>
 
  </body>

    <script>
      $(function () {

        //window Height and Width
        var windowHeight = window.innerHeight;    
        var windowWidth = window.innerWidth;

        //dynamic Canvas class declaration
        var dynamicCanvas = fabric.util.createClass(fabric.Canvas, {
          initialize: function(c, winWidth, winHeight){
            this.callSuper('initialize', c);
            this.setWidth(winWidth);
            this.setHeight(winHeight);
          },
        });//end of dynamicCanvas class declaration

        //instance of dynamicCanvas
        var canvas = new dynamicCanvas('canvas', windowWidth, windowHeight, {
                backgroundColor: 'rgb(200, 247, 250)'
            });

        var canHeight = canvas.getHeight();
        var canWidth = canvas.getWidth();

        //calculate midpoint of canvas
        var midPoint = canHeight / 2;
        var bottomThirds = midPoint / 3;
        var bottomTwoThirds = bottomThirds * 2;
        var sandTop = midPoint + bottomTwoThirds;

        var oceanBottomThird = bottomTwoThirds /3;
        var wavesTop = sandTop - oceanBottomThird;
        var wavesHeight = bottomTwoThirds / 3;

        //custom rectangle class declaration
        var customRect = fabric.util.createClass(fabric.Rect, {
          initialize: function(top, height, fill){
            this.callSuper('initialize');
            this.top = top || 0;
            this.left = 0;
            this.height = height || 100;
            this.width = canWidth;
            this.hasControls = false;
            this.hasBorders = false;
            this.selectable = false;
            this.fill = fill || 'rgb(55, 55, 55)';
            
          },

          //animateRect: function() {
            //console.log(this.top);
              //fabric.util.animate({
                //startValue: this.top,
                //endValue: this.top+50,
                //duration: 1000,
                //onChange: function() {
                  //this.top = wavesTop;
                  // only render once
                  
                  //canvas.renderAll();
                  //} 
                //}) 

          //},//end animateRect function

        })//end custom rectangle class declaration


        //instances of custom rectangle class
        var rectBackground = new customRect(0, canHeight, 'rgb(137, 207, 240)');

        var rectOcean = new customRect(midPoint, bottomTwoThirds, 'rgb(120, 182, 164)');

        var rectSand = new customRect(sandTop, bottomThirds, 'rgb(235, 217, 178)');

        var rectWaves = new customRect(wavesTop, wavesHeight, 'rgb(50, 217, 178)');

        var rectInvisWaves = new customRect(wavesTop, wavesHeight, 'rgb(50, 217, 178)');
        rectInvisWaves.setOpacity(0);

        rectOcean.setGradient('fill', {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: rectOcean.height / 2,
            colorStops: {
                0: 'rgb(120, 182, 164)',
                1: 'rgb(160,235,203)'
            }
        });

            rectSand.setGradient('fill', {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: rectOcean.height / 2,
            colorStops: {
                0: 'rgb(184, 162, 129)',
                0.4: 'rgb(235, 217, 178)',
                0.5: 'rgb(235, 217, 178)',
                1: 'rgb(235, 217, 178)'
            }
        });

            rectBackground.setGradient('fill', {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: rectBackground.height / 2,
            colorStops: {
                0: 'rgb(119, 195, 253)',
                0.3: 'rgb(143, 207, 255)',
                1: 'rgb(188, 223, 249)'
            }
          });

            rectWaves.setGradient('fill', {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: rectWaves.height / 2,
            colorStops: {
                0: 'rgb(255, 255, 255)',
                0.3: 'rgba(255, 255, 255, 0.5)',
                1: 'rgba(160, 235, 203, 0)'
            }
        });
            rectInvisWaves.setGradient('fill', {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: rectWaves.height / 2,
            colorStops: {
                0: 'rgb(255, 255, 255)',
                0.3: 'rgba(255, 255, 255, 0.5)',
                1: 'rgba(160, 235, 203, 0)'
            }
        });

      function opaqueFinal(){
        rectInvisWaves.animate('opacity', 0,{ 
                duration:1000000,
                onChange: canvas.renderAll.bind(canvas),
                easing: fabric.util.ease.easeOutSine,
                //onComplete: animateRect2(),
            });

      }//end function opaqueFinal

      function opaque2(){
        rectInvisWaves.animate('top', sandTop ,{ 
                duration:12000,
                onChange: canvas.renderAll.bind(canvas),
                easing: fabric.util.ease.easeInSine,
                //onComplete: opaqueFinal(),
            })
        console.log("opaque2");
      }//end function opaque

    function animateRect2(){
        rectInvisWaves.animate('opacity', 1, {
          duration:4000,
          onChange: canvas.renderAll.bind(canvas),
          easing: fabric.util.ease.easeInSine,
          onComplete: opaque2(),
        });
        console.log("animateRect2");
      }//end function animateRect()

      function opaque(){
        rectWaves.animate('opacity', 0,{ 
                duration:17000,
                onChange: canvas.renderAll.bind(canvas),
                easing: fabric.util.ease.easeOutSine,
                onComplete: animateRect2(),
            });
        console.log("opaque" + rectWaves.top);
        //rectInvisWaves.setVisible(true);
      }//end function opaque

      function animateRect(){
        rectWaves.animate('top', sandTop, {
          duration:6000,
          onChange: canvas.renderAll.bind(canvas),
          onComplete: opaque(),
        });
        
        
        //setTimeout(animateRect(), 100000);
        console.log("animateRect");
      }//end function animateRect()

      

      function resetRect(){
        console.log("hi");
        canvas.renderAll.bind(canvas);
      }//end function resetRect()
   

        canvas.add(rectBackground, rectOcean, rectSand, rectWaves, rectInvisWaves);

        //setInterval(rectWaves.animateRect(), 100);
        setTimeout(function animate() {
            for (i = 0; i < 5; i++){
            //rectWaves.animateRect();
            animateRect();
            //opaque2();
            //canvas.renderAll();
            //resetRect();
          }
          //setTimeout(animate, 500);
       }, 100);


      });//end of function ready

    </script>
</html>